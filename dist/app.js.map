{"version":3,"sources":["../app.js"],"names":["async","require","express","multipart","http","morgan","method_override","body_parser","cookie_parser","errorhandler","routes","config","util","app","is_development","get","enable","set","process","env","PORT","use","allow_cross_domain","json","urlencoded","extended","my_error_handler","router","createServer","listen","console","log","req","res","next","headers","origin","method","header","sendStatus","err","code","body","status","send","toString","errorLog"],"mappings":"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","file":"app.js","sourcesContent":["\nvar async = require('async');\nvar express = require('express');\nvar multipart = require('connect-multiparty');\nvar http = require('http');\nvar morgan = require('morgan');\nvar method_override = require('method-override');\nvar body_parser = require('body-parser');\nvar cookie_parser = require('cookie-parser');\nvar errorhandler = require('errorhandler');\n\n// Local Files\nvar routes = require('./routes');\nvar config = require('./config.json');\nvar util = require('./util.js');\n\nvar app = express();\nvar is_development = app.get('env') == 'development';\n\n\napp.enable('trust proxy')\napp.set('port', process.env.PORT || 3020);\n\nif(is_development) {\n  app.use(morgan('[:date] :method :url :status :res[content-length] - :response-time ms'));\n} else {\n  app.use(morgan(':remote-addr - - [:date] \":method :url HTTP/:http-version\" :status :response-time(ms) \":referrer\" \":user-agent\"'));\n}\napp.use(allow_cross_domain);\napp.use(body_parser.json());\napp.use(body_parser.urlencoded({ extended: false }));\napp.use(multipart());\napp.use(cookie_parser());\napp.use(method_override());\napp.use(my_error_handler);\napp.use(routes.router);\n\nhttp.createServer(app).listen(app.get('port'),function() {\n  console.log('Express server listening on port ' + app.get('port'));\n});\n\nfunction allow_cross_domain(req,res,next) {\n  if (req.headers.origin || req.method == 'OPTIONS') {\n    if (req.headers.origin) {\n      res.header(\"Access-Control-Allow-Origin\",req.headers.origin);\n    } else {\n      res.header(\"Access-Control-Allow-Origin\",\"*\");\n    }\n    res.header(\"Access-Control-Allow-Methods\",\"GET,PUT,POST,DELETE,OPTIONS\");\n    res.header(\"Access-Control-Allow-Headers\",\n      \"Content-Type,Accept,X-Requested-With,X-HTTP-Method-Override,X-Yobs-API-Key,X-Yobs-User-Session-Key,X-Yobs-Admin-Session-Key\");\n    res.header(\"Access-Control-Max-Age\",\"3600\");\n  }\n\n  if (req.method == 'OPTIONS') {\n    res.header(\"Cache-Control\",\"public, max-age=3600\");\n    res.header(\"Vary\",\"Origin\");\n    res.sendStatus(204);\n  } else {\n    next();\n  }\n}\nfunction my_error_handler(err,req,res,next) {\n  if (err && err.code && err.body && typeof err.code === 'number') {\n    res.header(\"Cache-Control\", \"no-cache, no-store, must-revalidate\");\n    res.header(\"Content-Type\",\"text/plain\");\n    res.status(err.code).send(err.body.toString());\n  } else if( is_development ) {\n    errorhandler()(err,req,res,next);\n  } else {\n    util.errorLog(\"Middleware err:\",err);\n    res.header(\"Cache-Control\", \"no-cache, no-store, must-revalidate\");\n    res.sendStatus(500);\n  }\n}\n"]}